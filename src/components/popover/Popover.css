:root {
  --aui-popover-bg: var(--aui-color-bg, #fff);
  --aui-popover-fg: var(--aui-color-text, #0f172a);
  --aui-popover-border: var(--aui-color-border, #e2e8f0);
  --aui-popover-offset: 8px;
}

.aui-popover { position: relative; display: inline-block; }

.aui-popover__content {
  position: absolute; z-index: 160;
  min-width: 200px; max-width: 360px;
  background: var(--aui-popover-bg); color: var(--aui-popover-fg);
  border: 1px solid var(--aui-popover-border); border-radius: 12px;
  box-shadow: 0 20px 60px rgba(2,6,23,.25);
  opacity: 0; transform: translateY(-2px) scale(.98);
  pointer-events: none;
  transition: opacity .14s ease, transform .14s ease;
  overflow: hidden;
}
.aui-popover__content.is-open { opacity: 1; transform: translateY(0) scale(1); pointer-events: auto; }

.aui-popover__header {
  display: flex; align-items: center; justify-content: space-between; gap: 8px;
  padding: 10px 12px; border-bottom: 1px solid var(--aui-popover-border);
}
.aui-popover__title { margin: 0; font-size: 14px; font-weight: 600; }
.aui-popover__close { width: 28px; height: 28px; border-radius: 8px; border: 1px solid var(--aui-popover-border); background: transparent; cursor: pointer; }
.aui-popover__body { padding: 12px; }

.aui-popover__arrow {
  position: absolute; width: 10px; height: 10px; background: var(--aui-popover-bg);
  border: 1px solid var(--aui-popover-border); transform: rotate(45deg);
}

/* sides + alignments */
.side-bottom { top: calc(100% + var(--aui-popover-offset)); }
.side-top    { bottom: calc(100% + var(--aui-popover-offset)); }
.side-left   { right: calc(100% + var(--aui-popover-offset)); }
.side-right  { left: calc(100% + var(--aui-popover-offset)); }

.align-start.side-bottom,
.align-start.side-top { left: 0; }
.align-center.side-bottom,
.align-center.side-top { left: 50%; transform: translate(-50%, -2px) scale(.98); }
.align-end.side-bottom,
.align-end.side-top { right: 0; }

.align-start.side-left,
.align-start.side-right { top: 0; }
.align-center.side-left,
.align-center.side-right { top: 50%; transform: translate(0, -50%) scale(.98); }
.align-end.side-left,
.align-end.side-right { bottom: 0; }

/* open transforms tidy up */
.is-open.align-center.side-top,
.is-open.align-center.side-bottom { transform: translate(-50%, 0) scale(1); }
.is-open.align-center.side-left,
.is-open.align-center.side-right { transform: translate(0, -50%) scale(1); }
.is-open:not(.align-center) { transform: translate(0,0) scale(1); }

/* arrow placement */
.side-bottom .aui-popover__arrow { bottom: 100%; left: 16px; transform: translateY(4px) rotate(45deg); border-bottom-color: var(--aui-popover-border); border-right-color: var(--aui-popover-border); border-top-color: transparent; border-left-color: transparent; }
.side-top    .aui-popover__arrow { top: 100%; left: 16px; transform: translateY(-4px) rotate(45deg); border-top-color: var(--aui-popover-border); border-left-color: var(--aui-popover-border); border-bottom-color: transparent; border-right-color: transparent; }
.side-left   .aui-popover__arrow { left: 100%; top: 16px; transform: translateX(-4px) rotate(45deg); border-left-color: var(--aui-popover-border); border-bottom-color: var(--aui-popover-border); border-top-color: transparent; border-right-color: transparent; }
.side-right  .aui-popover__arrow { right: 100%; top: 16px; transform: translateX(4px) rotate(45deg); border-right-color: var(--aui-popover-border); border-top-color: var(--aui-popover-border); border-left-color: transparent; border-bottom-color: transparent; }

/* dark scheme when near dark navbar */
.aui-navbar--dark ~ * .aui-popover__content {
  --aui-popover-bg:#0b1220; --aui-popover-fg:#e5e7eb; --aui-popover-border:rgba(255,255,255,.12);
}
